<!DOCTYPE html>
<html>
<head>
    <title>Silicon Switch: Valence Jump</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; }
        #game-container { position: relative; height: 100vh; overflow: hidden; }
        
        /* The House Visual */
        #house { width: 200px; margin-top: 50px; transition: filter 0.5s; filter: brightness(0.2); }
        .lit { filter: brightness(1.5) drop-shadow(0 0 20px yellow) !important; }

        /* The Bands */
        .band { width: 80%; height: 100px; margin: 20px auto; border: 2px dashed #444; border-radius: 10px; position: relative; }
        #conduction-band { background: rgba(0, 255, 255, 0.1); }
        #valence-band { background: rgba(255, 100, 0, 0.1); }
        
        .electron { width: 20px; height: 20px; background: cyan; border-radius: 50%; position: absolute; transition: all 0.3s; }
        
        #data-panel { background: rgba(0,0,0,0.8); padding: 10px; position: fixed; bottom: 0; width: 100%; font-size: 12px; }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>LEVEL 1: VALENCE JUMP</h1>
        <p>Shake to add Thermal Energy (kT)</p>
        
        <img id="house" src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Simple_home_icon.svg" alt="House">

        <div id="conduction-band" class="band"><p>Conduction Band (Empty)</p></div>
        <div id="valence-band" class="band"><p>Valence Band (Full)</p></div>

        <button onclick="requestAccess()" style="padding: 15px; font-size: 18px;">START EXPERIMENT</button>
    </div>

    <div id="data-panel">
        Energy Input (G): <span id="force">0</span> | Electrons Conducted: <span id="count">0</span>
    </div>

    <script>
        let electrons = [];
        let conductedCount = 0;

        // Create 5 electrons in the Valence Band
        for (let i = 0; i < 5; i++) {
            let el = document.createElement('div');
            el.className = 'electron';
            el.style.left = (20 + (i * 15)) + "%";
            el.style.bottom = "20px";
            document.getElementById('valence-band').appendChild(el);
            electrons.push({ dom: el, state: 'valence' });
        }

        function requestAccess() {
            // Required for iOS
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(response => {
                    if (response == 'granted') {
                        window.addEventListener('devicemotion', handleMotion);
                    }
                });
            } else {
                window.addEventListener('devicemotion', handleMotion);
            }
        }

        function handleMotion(event) {
            let acc = event.accelerationIncludingGravity;
            let totalForce = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
            document.getElementById('force').innerText = totalForce.toFixed(2);

            // If shake is strong enough, move ONE electron up
            if (totalForce > 25) { 
                let waitingEl = electrons.find(e => e.state === 'valence');
                if (waitingEl) {
                    waitingEl.state = 'conduction';
                    conductedCount++;
                    document.getElementById('count').innerText = conductedCount;
                    
                    // Visual "Jump"
                    waitingEl.dom.style.bottom = "250px"; // Moves to top band
                    
                    // Check if enough electrons are conducting to light house
                    if (conductedCount >= 3) {
                        document.getElementById('house').classList.add('lit');
                    }
                }
            }
        }
    </script>
</body>
</html>