<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Master: Data Collector</title>
    <style>
        body { 
            margin: 0; padding: 0; background: #121212; color: white; 
            font-family: 'Segoe UI', sans-serif; text-align: center; overflow: hidden; 
        }

        /* --- Top Dashboard & Mission --- */
        #header-container {
            background: rgba(0,0,0,0.95); padding: 15px; position: fixed; 
            top: 0; width: 100%; border-bottom: 2px solid #333; z-index: 100;
        }
        .stat-line { font-size: 1em; margin-bottom: 5px; }
        .stat-val { color: #00ffff; font-weight: bold; }
        #mission-text { color: #ffcc00; font-size: 0.85em; font-style: italic; margin-top: 8px; }

        /* --- Info Screen --- */
        #info-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000; z-index: 1000; display: flex; 
            flex-direction: column; justify-content: center; align-items: center; 
            padding: 40px; box-sizing: border-box;
        }
        #start-btn {
            background: none; color: #00ffff; border: 2px solid #00ffff;
            padding: 15px 40px; font-size: 1.2em; cursor: pointer;
        }

        /* --- Success & Record UI --- */
        #record-container {
            display: none; position: fixed; top: 45%; left: 50%;
            transform: translate(-50%, -50%); z-index: 500;
        }
        #record-btn {
            background: #00ff00; color: black; border: none;
            padding: 20px 40px; font-size: 1.2em; font-weight: bold;
            border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px #00ff00;
        }
        #log-display { font-size: 0.9em; color: #00ff00; margin-top: 15px; }

        /* --- Game Layout --- */
        #game-container { 
            display: flex; flex-direction: column; height: 100vh;
            justify-content: center; padding-top: 120px; box-sizing: border-box;
        }
        #house-wrapper {
            width: 140px; margin: 0 auto 30px auto;
            transition: filter 0.5s; filter: brightness(0.1);
        }
        #house-wrapper.lit { filter: brightness(1.5) drop-shadow(0 0 25px #ffff00); }
        #house-svg { fill: #fff; width: 100%; }

        .band { 
            width: 75%; height: 60px; margin: 10px auto; 
            border: 2px dashed #444; border-radius: 10px; 
            position: relative; display: flex; justify-content: center; align-items: center;
        }
        #resistor-band { background: rgba(0, 255, 255, 0.05); border-color: #00ffff; }
    </style>
</head>
<body>

    <div id="header-container">
        <div class="stat-line">
            VOLT: <span class="stat-val">12V</span> | 
            RES: <span id="res-val" class="stat-val">0</span>Ω | 
            CUR: <span id="cur-val" class="stat-val">0.00</span>A
        </div>
        <div id="mission-text">MISSION: STABILIZE GRID AT 0.50A (+/- 0.02)</div>
    </div>

    <div id="info-screen">
        <h1>GRID MASTER</h1>
        <p>Tilt your phone to find the Resistance needed for 0.5 Amps.</p>
        <button id="start-btn" onclick="initGame()">START MISSION</button>
    </div>

    <div id="record-container">
        <button id="record-btn" onclick="freezeValue()">RECORD VALUE</button>
        <div id="log-display"></div>
    </div>

    <div id="game-container">
        <div id="house-wrapper">
            <svg id="house-svg" viewBox="0 0 512 512"><path d="M506.1 233.1L277.1 19.3c-11.5-10.4-29.3-10.4-40.8 0L9.9 233.1c-14.4 13-14.4 34.3 0 47.3s34.3 13 48.7 0l24.4-22v177.6c0 42.4 34.4 76.8 76.8 76.8h192.1c42.4 0 76.8-34.4 76.8-76.8V258.4l24.4 22c14.4 13 34.3 13 48.7 0s14.4-34.3-.1-47.3zM320 352v128h-128V352c0-35.3 28.7-64 64-64s64 28.7 64 64z"/></svg>
        </div>
        <div id="resistor-band" class="band">
            <div style="color: #00ffff; font-size: 1.5em;">〰️〰️〰️</div>
        </div>
    </div>

    <script>
        let isFrozen = false;
        let conductedCount = 0;

        function initGame() {
            document.getElementById('info-screen').style.display = 'none';
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(state => {
                    if (state === 'granted') window.addEventListener('deviceorientation', handleTilt);
                });
            } else {
                window.addEventListener('deviceorientation', handleTilt);
            }
        }

        function handleTilt(event) {
            if (isFrozen) return; // Stops updating when frozen

            let tilt = event.gamma; 
            let R = Math.max(10, Math.min(60, (tilt + 90) / 3)); 
            let V = 12;
            let I = V / R;

            document.getElementById('res-val').innerText = R.toFixed(1);
            document.getElementById('cur-val').innerText = I.toFixed(2);

            if (I > 0.48 && I < 0.52) {
                document.getElementById('house-wrapper').classList.add('lit');
                document.getElementById('record-container').style.display = 'block';
            } else {
                document.getElementById('house-wrapper').classList.remove('lit');
                document.getElementById('record-container').style.display = 'none';
            }
        }

        function freezeValue() {
            isFrozen = true; // Freezes the values
            let finalR = document.getElementById('res-val').innerText;
            let finalI = document.getElementById('cur-val').innerText;
            document.getElementById('record-btn').style.display = 'none';
            document.getElementById('log-display').innerHTML = 
                `DATA LOGGED:<br>R = ${finalR}Ω | I = ${finalI}A<br><br><button onclick="location.reload()" style="color:cyan; background:none; border:1px solid cyan; padding:5px;">RESET GRID</button>`;
        }
    </script>
</body>
</html>