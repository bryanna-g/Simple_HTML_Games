<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agrovoltaics Solar Farm Challenge</title>

<style>
:root{
  --sky1:#87ceeb;
  --sky2:#4facfe;
  --ground:#5fa85f;
  --panel:#1e3a8a;
  --shade:#0d397e;
  --text:#0f172a;
  --accent:#f59e0b;
}
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(to bottom,var(--sky1),var(--sky2));
  color:var(--text);
}
header{
  text-align:center;
  padding:12px;
  font-weight:700;
  font-size:20px;
}
.container{
  display:flex;
  gap:20px;
  padding:15px;
}
.controls{
  width:260px;
  background:white;
  padding:15px;
  border-radius:15px;
  box-shadow:0 10px 20px rgba(0,0,0,.15);
}
.controls h3{
  margin-top:0;
}
label{
  font-size:13px;
}
input[type=range]{
  width:100%;
}
button{
  margin-top:8px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  font-weight:600;
  cursor:pointer;
}
button:hover{opacity:.9}
.metrics{
  margin-top:12px;
  font-size:14px;
}
canvas{
  border-radius:15px;
  box-shadow:0 10px 20px rgba(0,0,0,.2);
  background:linear-gradient(to bottom,#c7f9cc,#80ed99);
}
.win{
  font-size:18px;
  font-weight:700;
  color:green;
}
.lose{
  font-size:18px;
  font-weight:700;
  color:red;
}
</style>
</head>

<body>
<header> Agrovoltaics Solar Farm Challenge </header>

<div class="container">
<div class="controls">
<h3>Game Settings</h3>

<label>Tilt Angle (<span id="tiltVal">30</span>¬∞)</label>
<input type="range" id="tilt" min="0" max="60" value="30">

<label>Season</label>
<select id="season">
<option value="1">Summer ‚òÄÔ∏è</option>
<option value="0.7">Spring üåº</option>
<option value="0.5">Fall üçÇ</option>
<option value="0.3">Winter ‚ùÑÔ∏è</option>
</select>

<label>Cloudiness (<span id="cloudVal">20</span>%)</label>
<input type="range" id="cloud" min="0" max="60" value="20">

<button onclick="startLevel()">Start Level</button>
<button onclick="nextLevel()">Next Level</button>

<div class="metrics">
<p>Level: <span id="level">1</span></p>
<p>Time: <span id="timer">60</span>s</p>
<p>Energy: <span id="energy">0</span></p>
<p>Crop Yield: <span id="crop">100</span>%</p>
<p>Score: <span id="score">0</span></p>
<p id="status"></p>
</div>
</div>

<canvas id="board" width="700" height="500"></canvas>
</div>

<script>
const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");

const rows=8, cols=12;
const cellW=canvas.width/cols;
const cellH=canvas.height/rows;

let panels=Array.from({length:rows},()=>Array(cols).fill(false));
let shade=Array.from({length:rows},()=>Array(cols).fill(0));

let level=1;
let timeLeft=60;
let timerInterval;

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

for(let r=0;r<rows;r++){
for(let c=0;c<cols;c++){
let x=c*cellW;
let y=r*cellH;

ctx.fillStyle="#a7f3d0";
ctx.fillRect(x,y,cellW,cellH);

if(shade[r][c] > 0.8){
    ctx.fillStyle = "rgba(30,64,175,0.7)";  // dark shade
    ctx.fillRect(x, y, cellW, cellH);
}
else if(shade[r][c] > 0.3){
    ctx.fillStyle = "rgba(96,165,250,0.5)"; // lighter shade
    ctx.fillRect(x, y, cellW, cellH);
}

if(panels[r][c]){
ctx.fillStyle="#1e3a8a";
ctx.fillRect(x+5,y+5,cellW-10,cellH-10);
}
ctx.strokeStyle="#16a34a";
ctx.strokeRect(x,y,cellW,cellH);
}
}
}

canvas.addEventListener("click",(e)=>{
const rect=canvas.getBoundingClientRect();
const x=e.clientX-rect.left;
const y=e.clientY-rect.top;
const c=Math.floor(x/cellW);
const r=Math.floor(y/cellH);
panels[r][c]=!panels[r][c];
calculate();
});

function calculate(){
shade=Array.from({length:rows},()=>Array(cols).fill(0));
let tilt=document.getElementById("tilt").value/60;
let cloud=document.getElementById("cloud").value/100;
let season=document.getElementById("season").value;

let energy=0;
let shadeRadius=Math.round(tilt*3)+1;

for(let r=0;r<rows;r++){
for(let c=0;c<cols;c++){
if(panels[r][c]){
let irradiance=1000*season*(1-cloud);
let panelEnergy=irradiance*Math.cos((30-tilt*60)*Math.PI/180);
energy+=panelEnergy/1000;

for(let dr=-shadeRadius;dr<=shadeRadius;dr++){
for(let dc=-shadeRadius;dc<=shadeRadius;dc++){
let rr=r+dr, cc=c+dc;
if(rr>=0&&rr<rows&&cc>=0&&cc<cols){
let dist=Math.sqrt(dr*dr+dc*dc);
if(dist<=shadeRadius) shade[rr][cc]+=0.2;
}
}
}
}
}
}

let avgShade=shade.flat().reduce((a,b)=>a+b,0)/(rows*cols);
let cropYield=Math.max(0,100-(avgShade*80));
let score=(energy*(cropYield/100)).toFixed(2);

document.getElementById("energy").textContent=energy.toFixed(2);
document.getElementById("crop").textContent=cropYield.toFixed(0);
document.getElementById("score").textContent=score;

checkWin(score);
draw();
}

function checkWin(score){
let target=50*level;
if(score>=target){
document.getElementById("status").textContent="üéâ Level Complete!";
document.getElementById("status").className="win";
clearInterval(timerInterval);
}else if(timeLeft<=0){
document.getElementById("status").textContent="‚ùå Time's Up!";
document.getElementById("status").className="lose";
}
}

function startLevel(){
clearInterval(timerInterval);
timeLeft=60-(level*5);
document.getElementById("timer").textContent=timeLeft;
document.getElementById("status").textContent="";
timerInterval=setInterval(()=>{
timeLeft--;
document.getElementById("timer").textContent=timeLeft;
if(timeLeft<=0){
clearInterval(timerInterval);
checkWin(0);
}
},1000);
calculate();
}

function nextLevel(){
level++;
document.getElementById("level").textContent=level;
panels=Array.from({length:rows},()=>Array(cols).fill(false));
startLevel();
}

document.getElementById("tilt").oninput=e=>{
document.getElementById("tiltVal").textContent=e.target.value;
calculate();
};
document.getElementById("cloud").oninput=e=>{
document.getElementById("cloudVal").textContent=e.target.value;
calculate();
};

draw();
</script>
</body>
</html>